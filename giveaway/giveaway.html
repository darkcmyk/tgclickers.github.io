<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ</title>
  <link rel="stylesheet" href="common.css">
</head>
<body>
  <div class="container">
    <h1 id="title">–ò–≥—Ä–∞</h1>
    <p id="desc">–û–ø–∏—Å–∞–Ω–∏–µ...</p>
    <input id="guessInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ">
    <button onclick="submitGuess()">–£–≥–∞–¥–∞—Ç—å</button>
    <p id="result"></p>
  </div>

  <script>
    const id = new URLSearchParams(location.search).get("id");
    const user = JSON.parse(localStorage.getItem("user") || "{}");

    if (!user.id) {
      location.href = `https://discord.com/oauth2/authorize?client_id=906537656555565106&redirect_uri=https://gastworld-big-mc.ru/giveaway/callback.html&response_type=code&scope=identify&state=${id}`;
    }

    async function submitGuess() {
      const guess = document.getElementById("guessInput").value;
      const res = await fetch("https://5ecf2cd5-b718-4734-aba6-2259aa598570-00-3s7c11zdialc7.pike.replit.dev/guess", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, guess, userId: user.id, username: user.username + "#" + user.discriminator })
      });
      const data = await res.json();
      document.getElementById("result").textContent = {
        correct: "üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í—ã –ø–æ–±–µ–¥–∏–ª–∏!",
        wrong: "‚ùå –ù–µ–≤–µ—Ä–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ.",
        already_won: "‚úÖ –í—ã —É–∂–µ –≤—ã–∏–≥—Ä—ã–≤–∞–ª–∏."
      }[data.status] || "–û—à–∏–±–∫–∞.";
    }
  </script>
</body>
</html>
