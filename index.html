<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TON –ö–∞–∑–∏–Ω–æ —Å –æ–ø–ª–∞—Ç–æ–π</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    text-align: center;
    margin: 0; padding: 0 10px 40px;
  }
  header {
    font-size: 24px;
    margin: 10px 0 20px;
    font-weight: 700;
  }
  button {
    background: #3affb2;
    border: none;
    color: #000;
    font-weight: 700;
    padding: 10px 20px;
    border-radius: 12px;
    cursor: pointer;
    margin: 5px;
    user-select: none;
    transition: background 0.3s;
  }
  button:hover {
    background: #31d8a3;
  }
  #wallet-connect {
    background: #0072ce;
    color: white;
    max-width: 240px;
    margin: 10px auto 20px;
    display: block;
  }
  #wallet-info {
    margin: 10px 0 20px;
    font-size: 16px;
    color: #3affb2;
    user-select: text;
  }
  #toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    max-width: 320px;
    z-index: 99999;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .toast {
    background: #333;
    color: #fff;
    padding: 12px 18px;
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0,0,0,0.7);
    font-weight: 600;
    font-size: 14px;
    opacity: 0.95;
    user-select: none;
    animation: slideIn 0.3s ease forwards;
  }
  .toast.success { background: #4ade80; color: #000; }
  .toast.error { background: #f87171; color: #000; }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 0.95; }
  }
  @media(max-width: 480px) {
    #toast-container {
      right: 10px;
      left: 10px;
      bottom: 10px;
      max-width: unset;
    }
  }
  #casino {
    max-width: 400px;
    margin: 0 auto;
  }
  .game {
    background: #222;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 12px;
  }
  .result {
    margin-top: 10px;
    font-weight: 700;
    font-size: 16px;
    color: #3affb2;
    min-height: 24px;
  }
</style>
</head>
<body>

<header>üé∞ TON –ö–∞–∑–∏–Ω–æ —Å –æ–ø–ª–∞—Ç–æ–π</header>

<button id="wallet-connect">–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫</button>
<div id="wallet-info"></div>

<div id="casino" style="display:none;">

  <div class="game" id="coin-flip-game">
    <h3>–ú–æ–Ω–µ—Ç–∫–∞ (0.05 TON)</h3>
    <button id="coin-flip-btn">–ü–æ–¥–±—Ä–æ—Å–∏—Ç—å –º–æ–Ω–µ—Ç–∫—É</button>
    <div class="result" id="coin-flip-result"></div>
  </div>

  <div class="game" id="slots-game">
    <h3>–°–ª–æ—Ç—ã (0.1 TON)</h3>
    <button id="slots-btn">–ö—Ä—É—Ç–∏—Ç—å —Å–ª–æ—Ç—ã</button>
    <div class="result" id="slots-result"></div>
  </div>

  <div class="game" id="roulette-game">
    <h3>–†—É–ª–µ—Ç–∫–∞ (0.1 TON)</h3>
    <label>–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ (0-9): </label>
    <input type="number" id="roulette-number" min="0" max="9" value="0" style="width:40px; font-weight:700;"/>
    <button id="roulette-btn">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    <div class="result" id="roulette-result"></div>
  </div>

  <div class="game" id="dice-game">
    <h3>–ö–æ—Å—Ç–∏ (0.1 TON)</h3>
    <button id="dice-btn">–ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏</button>
    <div class="result" id="dice-result"></div>
  </div>

</div>

<div id="toast-container"></div>

<!-- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TON Connect SDK -->
<script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk/dist/tonconnect.umd.min.js"></script>

<script>
  function showToast(message, type = 'success', duration = 4000) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + (type === 'error' ? 'error' : 'success');
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.opacity = '0';
      setTimeout(() => container.removeChild(toast), 400);
    }, duration);
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
  const tonConnect = new TonConnect.TonConnect({
    manifestUrl: 'https://darkcmyk.github.io/tgclickers.github.io/tonconnect-manifest.json'
  });

  const walletConnectBtn = document.getElementById('wallet-connect');
  const walletInfo = document.getElementById('wallet-info');
  const casinoDiv = document.getElementById('casino');

  let connectedWallet = null;

  async function fetchBalance(address) {
    try {
      const resp = await fetch(`https://toncenter.com/api/v2/getAddressInformation?address=${address}`);
      const json = await resp.json();
      if(json.ok && json.result) {
        return parseInt(json.result.balance) / 1e9;
      }
      return 0;
    } catch {
      return 0;
    }
  }

  async function updateBalance() {
    if(!connectedWallet) return;
    const balance = await fetchBalance(connectedWallet.account);
    walletInfo.textContent = `–ö–æ—à–µ–ª–µ–∫: ${connectedWallet.account} | –ë–∞–ª–∞–Ω—Å: ${balance.toFixed(4)} TON`;
    return balance;
  }

  walletConnectBtn.onclick = async () => {
    try {
      const connected = await tonConnect.connect();
      if(connected) {
        connectedWallet = connected;
        walletConnectBtn.style.display = 'none';
        casinoDiv.style.display = 'block';
        await updateBalance();
        showToast('–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω: ' + connected.account);
      }
    } catch (e) {
      showToast('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞', 'error');
      console.error(e);
    }
  };

  async function sendTon(amountTon) {
    if(!connectedWallet) {
      showToast('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫', 'error');
      return false;
    }
    try {
      await tonConnect.sendTransaction({
        validUntil: Math.floor(Date.now()/1000) + 600,
        messages: [{
          address: 'UQBfLcNf5TZZb6SEerk0Cr1V2AawL4glN0IG5DlO8mMyb7Uq',
          amount: (amountTon * 1e9).toString(),
          payload: '',
        }]
      });
      showToast(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${amountTon} TON –Ω–∞ –∞–¥—Ä–µ—Å –∫–∞–∑–∏–Ω–æ`);
      await updateBalance();
      return true;
    } catch(e) {
      showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏–ª–∏ –Ω–µ —É–¥–∞–ª–∞—Å—å', 'error');
      return false;
    }
  }

  // –ò–≥—Ä—ã:

  document.getElementById('coin-flip-btn').onclick = async () => {
    const stake = 0.05;
    const balance = await updateBalance();
    if(balance < stake) {
      showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏', 'error');
      return;
    }
    const ok = await sendTon(stake);
    if(!ok) return;

    const side = Math.random() < 0.5 ? '–û—Ä—ë–ª' : '–†–µ—à–∫–∞';
    const win = Math.random() < 0.5;
    const resultText = `–í—ã–ø–∞–ª–æ: ${side}. ` + (win ? `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(stake*2).toFixed(2)} TON! (–í—ã–ø–ª–∞—Ç—ã –≤—Ä—É—á–Ω—É—é)` : `–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.`);
    document.getElementById('coin-flip-result').textContent = resultText;
  };

  document.getElementById('slots-btn').onclick = async () => {
    const stake = 0.1;
    const balance = await updateBalance();
    if(balance < stake) {
      showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏', 'error');
      return;
    }
    const ok = await sendTon(stake);
    if(!ok) return;

    const symbols = ['üçí','üçã','üîî','‚≠ê','üçâ','7Ô∏è‚É£'];
    const slot1 = symbols[Math.floor(Math.random()*symbols.length)];
    const slot2 = symbols[Math.floor(Math.random()*symbols.length)];
    const slot3 = symbols[Math.floor(Math.random()*symbols.length)];
    const resElem = document.getElementById('slots-result');
    resElem.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${slot1} | ${slot2} | ${slot3}. `;

    if(slot1 === slot2 && slot2 === slot3) {
      resElem.textContent += `–î–∂–µ–∫–ø–æ—Ç! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(stake*5).toFixed(2)} TON! (–í—ã–ø–ª–∞—Ç—ã –≤—Ä—É—á–Ω—É—é)`;
    } else {
      resElem.textContent += `–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.`;
    }
  };

  document.getElementById('roulette-btn').onclick = async () => {
    const stake = 0.1;
    const balance = await updateBalance();
    if(balance < stake) {
      showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏', 'error');
      return;
    }
    const ok = await sendTon(stake);
    if(!ok) return;

    const userNumber = parseInt(document.getElementById('roulette-number').value);
    if(isNaN(userNumber) || userNumber < 0 || userNumber > 9) {
      showToast('–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 9', 'error');
      return;
    }
    const ball = Math.floor(Math.random()*10);
    const resElem = document.getElementById('roulette-result');
    resElem.textContent = `–í—ã–ø–∞–ª–æ —á–∏—Å–ª–æ: ${ball}. `;
    if(ball === userNumber) {
      resElem.textContent += `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(stake*9).toFixed(2)} TON! (–í—ã–ø–ª–∞—Ç—ã –≤—Ä—É—á–Ω—É—é)`;
    } else {
      resElem.textContent += `–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.`;
    }
  };

  document.getElementById('dice-btn').onclick = async () => {
    const stake = 0.1;
    const balance = await updateBalance();
    if(balance < stake) {
      showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏', 'error');
      return;
    }
    const ok = await sendTon(stake);
    if(!ok) return;

    const dice1 = Math.floor(Math.random()*6) + 1;
    const dice2 = Math.floor(Math.random()*6) + 1;
    const sum = dice1 + dice2;
    const resElem = document.getElementById('dice-result');
    resElem.textContent = `–í—ã–ø–∞–ª–æ: ${dice1} + ${dice2} = ${sum}. `;
    if(sum >= 7) {
      resElem.textContent += `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(stake*2).toFixed(2)} TON! (–í—ã–ø–ª–∞—Ç—ã –≤—Ä—É—á–Ω—É—é)`;
    } else {
      resElem.textContent += `–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.`;
    }
  };
</script>

</body>
</html>
